---
title: "Introduction to collecting web data with R"
author: "<big> Ivo Bantel <br> <br> <small> University of Zurich <br> Centre for Comparative & International Studies <br>
  <br>
  <a href='https://www.ipz.uzh.ch/en/institut/mitarbeitende/staff/ibantel.html'>
    <i class='fas fa-home' style='font-size:.9em;' ></i>
  </a>&#8239;
  <a href='mailto:bantel@ipz.uzh.ch'>
    <i class='fas fa-envelope' style='font-size: .9em;'></i>
  </a>&#8239;
  <a href='https://twitter.com/ivobantel'>
    <i class='fab fa-twitter' style='font-size: .9em;'></i>
  </a> <br> <br>"
date: "March 5, 2021" # `r Sys.Date()`
output:
  xaringan::moon_reader:
    css: ["default", "style.css"]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: '16:9'
      
---

layout: true

<div class="my-footer">
  <span style="text-align:center">
    <span>
      <img src="https://upload.wikimedia.org/wikipedia/commons/c/ce/Cc-by-nc-sa_euro_icon.svg" height=14 style="vertical-align: middle"/>
    </span>
      <a href = "https://github.com/ibantel/2021-03-05_CEU_Webscraping-with-R">
        <span style="padding-left:82px">
          <font color="#7E7E7E">Ivo Bantel (UZH / CIS)</font>
        </span>
        <font color="#7E7E7E">Collecting web data with R | March 5, 2021</font>
      </a>
</div> 

---

<br><br><br><br><br>



## While you wait...

... please ensure you installed all necessary packages

<br>
.pull-right95[
```{r, echo = T, eval = FALSE}
install.packages(c("rvest", "tidyverse", "knitr", "rmarkdown", "xml2"))
```
]

---


```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
# see: https://github.com/yihui/xaringan
# install.packages("xaringan")
# see: 
# https://github.com/yihui/xaringan/wiki
# https://github.com/gnab/remark/wiki/Markdown
options(width=110)
options(digits = 4)
```

```{r setup (2), echo = FALSE ,message = FALSE, warning = FALSE}
knitr::opts_chunk$set(comment=NA, fig.width=6, fig.height=6, echo = TRUE, eval = TRUE, message = FALSE, warning = FALSE, fig.align = 'center', dpi = 200)
library(tidyverse)
```


## Welcome & overview

### Plan of the course

<!--- - if you have not, **install packages!!!** --->
.pull-left55[
<ul>
  <li class="m1">Introduction</li><br>
  
  <li class="m1">Background scraping</li>
  <ul class="level">
    <li><span>why you should (not) scrape</span></li>
    <li><span>varieties of scraping</span></li>
    <li><span>HTML</span></li>
  </ul><br><br>

  <li class="m2">Hands-on</li>
  <ul class="level">
    <li><span>scraping tables</span></li>
    <li><span>extraction using CSS selectors</span></li>
    <li><span>scaling up: scraping several pages <!--- with loops and functions ---></span></li>
  </ul><br><br>
  
  <li class="m3">Outlook: overview of other techniques <!--- (RSS, APIs, Selenium, social media data) ---></li>
  
</ul>


]

.pull-right35[

<br><br><br><br>
<!---  ADD TIME VISUALIZATION | OR: package installations --->

]


---
class: inverse, center, middle

# 1. Introduction(s)

---

## Introduction (1)

<br><br>


.pull-left55[

### About me: Ivo Bantel
<br><br>
<ul>
  <li class="m1">PhD student (UZH, Digital Democracy Lab)</li><br>
  <li class="m2">_research interests_:</li>
    &#8239; &#8239; &#8239; &#8239; polarization, extreme right politics, political violence<br><br>
  <!--- <li class="m2">_teaching_: webscraping, qualitative methods, substantive courses</li><br>--->
  <li class="m2">_contact_:</li>
  &#8239; &#8239; &#8239; &#8239;
  <i class='fas fa-envelope' style='font-size:.9em;' ></i> &#8239; &#8239; &#8239; [bantel@ipz.uzh.ch](mailto:bantel@ipz.uzh.ch)
  <br> &#8239; &#8239; &#8239; &#8239;
  <i class='fab fa-twitter' style='font-size: .9em;'></i> &#8239; &#8239; &#8239; [@ivobantel](https://twitter.com/ivobantel) 
  <br>
<ul>
]

.pull-right25[
<a href='https://www.ipz.uzh.ch/en'><img src="./img/uzh.png" alt="UZH logo" height='200'> <br>
<a href='https://www.ipz.uzh.ch/en'><img src="./img/digdemlab.png" alt="DigDemLab logo" height='100'>

<!--- https://fontmeme.com/name-tags/ --->

]


---

## Introduction (2)
### Getting to know you



--

- How much experience do you have with R? <br> 
  &nbsp; <img src="./img/open-mouth.png" alt="open mouth" height="20"/> &nbsp; None &nbsp;  &nbsp;  &nbsp;
  &nbsp; <img src="./img/no.png" alt="no" height="20"/> &nbsp; Some  &nbsp;  &nbsp;  &nbsp;
  &nbsp; <img src="./img/yes.png" alt="yes" height="20"/> &nbsp; I can write functions &nbsp;  &nbsp;  &nbsp;
  &nbsp; <img src="./img/heart.png" alt="heart" height="20"/> &nbsp; I'm a pro


--

<br>

- Have you used `RMarkdown` notebooks before? <br> 
  &nbsp; <img src="./img/open-mouth.png" alt="open mouth" height="20"/> &nbsp; Don't know what that is &nbsp;  &nbsp;  &nbsp;
  &nbsp; <img src="./img/no.png" alt="no" height="20"/> &nbsp; I've opened one  &nbsp;  &nbsp;  &nbsp;
  &nbsp; <img src="./img/yes.png" alt="yes" height="20"/> &nbsp; I've written some &nbsp;  &nbsp;  &nbsp;
  &nbsp; <img src="./img/heart.png" alt="heart" height="20"/> &nbsp; All the time

--

<br>

- Have you ever webscraped? <br>
  &nbsp; <img src="./img/open-mouth.png" alt="open mouth" height="20"/> &nbsp; What _is_ that? &nbsp; &nbsp;
  &nbsp; <img src="./img/no.png" alt="no" height="20"/>                 &nbsp; Never           &nbsp; &nbsp;
  &nbsp; <img src="./img/yes.png" alt="yes" height="20"/>               &nbsp; Once            &nbsp; &nbsp;
  &nbsp; <img src="./img/heart.png" alt="heart" height="20"/>           &nbsp; I could teach it

--
 

<br>

- How comfortable are you with HTML? <br>
  &nbsp; <img src="./img/open-mouth.png" alt="open mouth" height="20"/> &nbsp; HTwhat? &nbsp; &nbsp; &nbsp;
  &nbsp; <img src="./img/no.png" alt="no" height="20"/>                 &nbsp; Heard of it    &nbsp; &nbsp;
  &nbsp; <img src="./img/yes.png" alt="yes" height="20"/>               &nbsp; I know basics  &nbsp; &nbsp;
  &nbsp; <img src="./img/heart.png" alt="heart" height="20"/>           &nbsp; I'm fluent



<br>


<!--- - Is there a specific webpage you want to scrape? (Use chat) --->

---
class: inverse, center, middle

# 2. Background scraping


---

## Scraping &mdash; and why you...
<br>

.pull-left45[
### &nbsp; &nbsp; &nbsp; ...should **not** do it



--


<br> 

**Legal, ethical, and logistical barriers**

- criminal code, copyright laws etc. <br> &rarr; check `robots.txt`, use `polite` package
- terms of service
- ethical regulations (privacy, GDPR, informed consent)
- measures to prevent scraping (API restrictions, 'distributed Turing test')

]

--

.pull-right45[
### &nbsp; &nbsp; &nbsp; ... should do it
<br> 

**Data availability**
- increasing amount of public data online ('open government')
- increasing amount of politics happens online
- increasing amount of people use the internet
- we share everything online
- that makes real world phenomena more visible online 
]



---

## Scraping: what is out there?

--

.pull-left45[

<br><b><font size=6 color = "A0A0A0">1. Scraping static pages</font></b></li>

]

.pull-right45[

  <a href = "https://www.theguardian.com/international">
    <img src="./img/theguardian.png" height=400 style="vertical-align: middle"/>
  </a>
  <font size=1>Screenshot "The Guardian"</font>

]


---

## Scraping: what is out there? (2)


.pull-left45[

<br><b><font size=6 color = "A0A0A0">1. Scraping static pages</font></b></li>
<br><br><br><br><font size=6 color = "A0A0A0">2. APIs <font size=4>(application programming interface)</font></font></li>

]

.pull-right45[

  <a href = "https://www.data.gov/developers/apis">
    <img src="./img/datagovapi.png" height=400 style="vertical-align: middle"/>
  </a>
  <font size=1>Screenshot "DATA.GOV"</font>

]



---

## Scraping: what is out there? (3)


.pull-left45[

<br><b><font size=6 color = "A0A0A0">1. Scraping static pages</font></b></li>
<br><br><br><br><font size=6 color = "A0A0A0">2. APIs <font size=4>(application programming interface)</font></font></li>
<br><br><br><br><font size=6 color = "000000">3. Dynamic pages</font></li>

]

.pull-right45[

  <br><br><br>
    <img src="./img/netflix.png" width=400 style="vertical-align: middle"/>
  <br>
  <font size=1>Screenshot "Netflix.com"</font>

]



---

## Scraping: what is out there? (4)


.pull-left45[

<br><b><font size=6 color = "A0A0A0">1. Scraping static pages</font></b>
<br><br><br><br><font size=6 color = "A0A0A0">2. APIs <font size=4>(application programming interface)</font></font></li>
<br><br><br><br><font size=6 color = "A0A0A0">3. Dynamic pages</font>
<br><br><br><br><font size=6 color = "000000">4. Web crawlers / spiders</font>

]

.pull-right45[

  <br>
    <img src="./img/crawler.png" width=400 style="vertical-align: middle"/>
  <br>
  <font size=0.1>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Created by Symbolon from the Noun Project</font>

]


---
class: inverse, center, middle

# 3. HTML



---

## HTML 101 (1): example

<br> 


.pull-left45[

### turning this... 
  <br>
    <img src="./img/quotes2scrape_code.png" style="vertical-align: middle"/>
  <br>
  <font size=0.1>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Screenshot sourcecode [quotes.toscrape.com](http://quotes.toscrape.com/).</font>
  
]


--

.pull-right45[

### ...into this
  <br><br><br>
    <img src="./img/quotes2scrape.png" style="vertical-align: middle"/>
  <br>
  <font size=0.1>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Screenshot [quotes.toscrape.com](http://quotes.toscrape.com/).</font>

]


---

## HTML 101 (2): elements

--

Components:

<br>

1. **HTML elements** (e.g. text)

2. **HTML tags** 
  - specify _character / behaviour_ of elements
  - usually encompass starting and end tag (exceptions: images, line breaks etc.)
  - surround the element they modify

<br>

Example: &nbsp; &nbsp; &nbsp; &nbsp; `<tagname>Some content here...</tagname> `



---

## HTML tags (1): basics

.pull-right85[
<br><br>
``` 
<html> 
    <head> 
        <title>Title of your web page</title> 
    </head> 
    <body> 
      <h1>Heading</h1>
      <p>HTML web page content</p>
    </body> 
</html> 
```
]


---

## HTML tags (2): headings & paragraphs

<ol>
<li>Headings (defined by numbered h tags):</li>

`<h1>my heading</h1>` &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font size=10>my heading</font>

`<h2>a smaller heading</h2>` &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font size=8>a smaller heading</font>

--

<br><br>
<li>Paragraphs are defined by div or p tags</li>

`<p>this is a paragraph.</p><div>and this is the next.</div>`
<p>this is a paragraph.</p><div>and this is the next.</div>


---

## HTML tags (3): attributes

`<tagname attribute="x"> Title </tagname>`

<br><br>

**Links and attributes**

`This text contains a <a href="http://theguardian.co.uk">link</a> to theguardian.co.uk` 

This text contains a <a href="http://theguardian.co.uk">link</a> to theguardian.co.uk


---

## HTML tags (4): Classes


<br><br>


.pull-left65[

### General example
`<div class="container">This is the text</div> `

]

.pull-right25[

<br><div class="container"> This is the text</div>

]



--


.pull-left65[
<br><br>
### Styling with Classes

```
<style>
    p.error {color: red;   border: 1px solid red;} 
</style>

    <p class="error">Red highlight</p>
```
]

.pull-right25[

<br><br><br><br><br><br><br><br>

<style>
p.error {
  color: red; border: 1px solid red;
} 
</style>
<p class="error">Red highlight</p>

]


---

## HTML tags: Practicalities

.pull-right95[
For ease of access, use Chrome [selector gadget](https://chrome.google.com/webstore/detail/selectorgadget/mhjhnkcfbdhnjickkkdbjoemdmbfginb).


<img src = "./img/css-selector.jpg" width = 900 style="horizontal-align: middle"/>
]

<br>


---

## HTML tags: Practise with the [CSS Diner](https://flukeout.github.io)

.pull-right95[<img src="./img/css-diner.jpg" width=850/>

]


---

class: inverse, center, middle
# 4. Let's start scraping


---

## `rvest`

<br><br>

.pull-left35[
<img src="./img/rvest.png" width=300 style="vertical-align: middle"/>
]


--


.pull-right55[<br><br>

### Main commands:
- `read_html()`
- `html_nodes()` / `html_node()`
- `html_text()`
- `html_table()`
- `html_attrs()` / `html_attr()`
]


---

## Scraping manually

<br><br>

.pull-left25[

- Specify resource

<br>

- Read ("parse") resource

<br>

- select elements
]

.pull-right75[
``` {r echo=T, eval=F}
url_quotes <- "http://quotes.toscrape.com" 
# call browseURL(url_quotes) to inspect page
```


``` {r echo=T, eval=F}
library(rvest)
page_quotes <- url_quotes %>% read_html()
```

<br>

``` {r echo=T, eval=F}
page_quotes %>% html_text() # removes tags & formatting

page_quotes %>% html_nodes("a") %>% # select links
  html_text() # select link texts
```
]

.pull-right85[

<br>

&rarr; **Let's practice** &nbsp; &nbsp; &nbsp; &nbsp; (Exercise 1 in `worksheet.Rmd`)

]
